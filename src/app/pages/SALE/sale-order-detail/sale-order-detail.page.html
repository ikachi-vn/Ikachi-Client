<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="sale-order"></ion-back-button>
            <ion-button color="dark" class="ion-hide-sm-down">
                ƒê∆°n h√†ng
            </ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
            <app-detail-toolbar [item]="item" [pageConfig]="pageConfig" (refresh)="refresh()" (delete)="delete()" (help)="help()"></app-detail-toolbar>
        </ion-buttons>
    </ion-toolbar>
</ion-header>


<ion-content appScrollbarTheme class="ion-padding">
    <div id="order-detail-page" style="position: absolute;"></div>
    <div class="main-view" *ngIf="item && pageConfig.showSpinner==false">
        <ion-grid fixed>
            <form [formGroup]="formGroup">
                <ion-row class="hr-group">
                    <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                        <ion-list-header class="ion-no-padding">
                            <ion-label color="primary">ƒê∆°n h√†ng</ion-label>
                        </ion-list-header>
                    </ion-col>
                    <ion-col size="12" size-sm size-xl="4">

                        <div class="c-control" *ngIf="item.Id">
                            <label class="c-label" for="Id"># Id</label>
                            <input class="c-input" id="Id" formControlName="Id" type="number">
                        </div>

                        <div class="c-control">
                            <label class="c-label" for="IDAddress">Kh√°ch h√†ng <small>{{item.IDContact}}</small>
                                <span *ngIf="!formGroup.controls.IDAddress.valid && !formGroup.controls.IDAddress.pending && (formGroup.controls.IDAddress.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                            </label>
                            <ng-select class="c-input" (change)="changedIDAddress($event)" #IDAddress labelForId="IDAddress" formControlName="IDAddress" [items]="contactList$ | async" [typeahead]="contactListInput$" [loading]='contactListLoading' [virtualScroll]="true" bindLabel="Name" bindValue="IDAddress" placeholder="T√¨m t√™n, m√£ ho·∫∑c s·ªë ƒëi·ªán tho·∫°i...">
                                <ng-template ng-label-tmp let-i="item" let-a="item.Address">
                                    {{i.Name}}
                                    <small *ngIf="a">
                                        <span *ngIf="a.AddressLine1"> | {{a.AddressLine1}}</span>
                                        <span *ngIf="a.Ward">, {{a.Ward}}</span>
                                        <span *ngIf="a.District">, {{a.District}}</span>
                                        <span *ngIf="a.Province">, {{a.Province}}</span>
                                    </small>
                                </ng-template>
                                <ng-template ng-option-tmp let-i="item" let-a="item.Address" let-search="searchTerm">
                                    <div *ngIf="i">
                                        <div>
                                            <span [ngOptionHighlight]="search">{{i.Name}}</span>
                                            <span *ngIf="i.WorkPhone"> | <small> <b [ngOptionHighlight]="search">{{i.WorkPhone}}</b> </small></span>
                                        </div>
                                        <small *ngIf="a">
                                            <b *ngIf="i.Code"><span class="important" [ngOptionHighlight]="search">{{i.Code}}</span></b>
                                            <span *ngIf="a.AddressLine1"> | {{a.AddressLine1}}</span>
                                            <span *ngIf="a.Ward">, {{a.Ward}}</span>
                                            <span *ngIf="a.District">, {{a.District}}</span>
                                            <span *ngIf="a.Province">, {{a.Province}}</span>
                                            <br *ngIf="a.AddressLine2 || a.Contact">
                                            <span *ngIf="a.AddressLine2">{{a.AddressLine2}}</span>
                                            <span *ngIf="a.Contact"> | Li√™n h·ªá: {{a.Contact}}</span>
                                            <span *ngIf="a.Phone1"> - {{a.Phone1}}</span>
                                            <span *ngIf="a.Phone2"> - {{a.Phone2}}</span>
                                        </small>
                                    </div>
                                </ng-template>
                            </ng-select>
                        </div>

                        <div class="c-control">
                            <label class="c-label" for="OriginalTotalAfterTax">T·ªïng ti·ªÅn <small>OriginalTotalAfterTax</small>
                                <span *ngIf="!formGroup.controls.OriginalTotalAfterTax.valid && !formGroup.controls.OriginalTotalAfterTax.pending && (formGroup.controls.OriginalTotalAfterTax.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                            </label>
                            <input (change)="saveChange()" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" suffix=" ‚Ç´" class="c-input" id="OriginalTotalAfterTax" formControlName="OriginalTotalAfterTax" type="text">
                        </div>

                        <div class="c-control" *ngIf="item.OriginalTotalAfterDiscountFromSalesman != item.OriginalTotalAfterDiscount">
                            <label class="c-label" for="OriginalTotalAfterDiscountFromSalesman">T·ªïng ti·ªÅn kh√°ch tr·∫£</label>
                            <input [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" suffix=" ‚Ç´" class="c-input" id="OriginalTotalAfterDiscountFromSalesman" [ngModelOptions]="{standalone: true}" [ngModel]="item.OriginalTotalAfterDiscountFromSalesman" type="text">
                        </div>

                    </ion-col>
                    <ion-col size="12" size-sm size-xl="4">
                        <div class="c-control" *ngIf="item.Id">
                            <label class="c-label">Ng√†y l√™n ƒë∆°n <small>OrderDate</small></label>

                            <span class="c-input disable">{{item.OrderDateText}}</span>
                        </div>

                        <div class="c-control">
                            <label class="c-label" for="ProductWeight">Kh·ªëi l∆∞·ª£ng <small>ProductWeight</small>
                                <span *ngIf="!formGroup.controls.ProductWeight.valid && !formGroup.controls.ProductWeight.pending && (formGroup.controls.ProductWeight.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                            </label>
                            <input readonly class="c-input" id="ProductWeight" formControlName="ProductWeight" type='text' mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" suffix=" kg">
                        </div>

                        <div class="c-control">
                            <label class="c-label" for="ProductDimensions">Th·ªÉ t√≠ch <small>Volume </small> &nbsp;&nbsp; <ion-text color="primary" *ngIf="item.ProductDimensionsM">{{item.ProductDimensionsM | mask: 'separator.2':','}} m¬≥</ion-text>
                                <span *ngIf="!formGroup.controls.ProductDimensions.valid && !formGroup.controls.ProductDimensions.pending && (formGroup.controls.ProductDimensions.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                            </label>

                            <input readonly class="c-input" id="ProductDimensions" formControlName="ProductDimensions" type='text' mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" suffix=" cm¬≥">
                        </div>


                        <!-- <div class="c-control">
                            <label class="c-label" for=""></label>
                            <ion-button *ngIf="!item.Id && pageConfig.canAdd" expand="block" (click)="saveChange()" [disabled]="!formGroup.dirty">Th√™m ƒë∆°n h√†ng</ion-button>
                        </div> -->

                        <div class="c-control ion-text-right">
                            <ion-button size="small" [disabled]="!(pageConfig.canEdit || (this.pageConfig.canChangeTypeOfReviewOrder && this.item.IDStatus == 103)) || submitAttempt" (click)="item.IsSampleOrder = !item.IsSampleOrder; changedSampleOrder()" [fill]=" item.IsSampleOrder? 'solid' : 'outline' ">
                                Sample
                            </ion-button>
                            <ion-button size="small" [disabled]="!(pageConfig.canEdit || (this.pageConfig.canChangeTypeOfReviewOrder && this.item.IDStatus == 103)) || submitAttempt" (click)="item.IsShipBySaleMan = !item.IsShipBySaleMan; saveChange()" [fill]=" item.IsShipBySaleMan? 'solid' : 'outline' ">
                                Bao ph·ªß
                            </ion-button>
                            <ion-button size="small" [disabled]="!(pageConfig.canEdit || (this.pageConfig.canChangeTypeOfReviewOrder && this.item.IDStatus == 103)) || submitAttempt" (click)="item.IsUrgentOrders = !item.IsUrgentOrders; saveChange()" [fill]=" item.IsUrgentOrders? 'solid' : 'outline' ">
                                Giao g·∫•p
                            </ion-button>
                            <ion-button size="small" [disabled]="!(pageConfig.canEdit || (this.pageConfig.canChangeTypeOfReviewOrder && this.item.IDStatus == 103)) || submitAttempt" (click)="item.IsWholeSale = !item.IsWholeSale; saveChange()" [fill]=" item.IsWholeSale? 'solid' : 'outline' ">
                                Kh√°ch s·ªâ
                            </ion-button>
                        </div>

                    </ion-col>
                </ion-row>

                <!-- <ion-row class="hr-group">
                    <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                        <ion-list-header class="ion-no-padding">
                            <ion-label color="primary">Th√¥ng tin s·∫£n ph·∫©m</ion-label>
                        </ion-list-header>
                    </ion-col>
                    <ion-col size="12" size-sm size-xl="4">
                        

                    </ion-col>
                    <ion-col size="12" size-sm size-xl="4">
                        
                    </ion-col>
                </ion-row> -->

            </form>
        </ion-grid>



        <div class="row-full shadow full-screen">
            <ion-toolbar color="primary">
                <ion-segment scrollable="true" (ionChange)="segmentChanged($event)" [value]="segmentView">

                    <ion-segment-button value="s1">
                        <ion-label>Danh s√°ch s·∫£n ph·∫©m</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="s2">
                        <ion-label>Khuy·∫øn m√£i / CK √°p d·ª•ng</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="s3">
                        <ion-label>Th√¥ng tin kh√°c</ion-label>
                    </ion-segment-button>

                </ion-segment>
            </ion-toolbar>

            <div>
                <div *ngIf="segmentView == 's1'">

                    <div class="table-contain">
                        <section class="table" style="min-width: 1340px;">
                            <header class="bold">
                                <div class="col-id cell">#</div>
                                <div class="col-name cell">S·∫£n ph·∫©n</div>
                                <div class="col-uom cell">ƒê∆°n v·ªã</div>
                                <div class="col-qty cell">S·ªë l∆∞·ª£ng</div>
                                <div class="col-discount cell" title="Chi·∫øt kh·∫•u c·ªßa h√£ng" *ngIf="pageConfig.canUseDiscountFromVendor">CK1 </div>
                                <div class="col-discount cell" title="Chi·∫øt kh·∫•u c·ªßa nh√† ph√¢n ph·ªëi" *ngIf="pageConfig.canUseDiscountFromDistributor">CK2 </div>

                                <div class="col-promotion cell" title="L√† h√†ng khuy·∫øn m√£i" *ngIf="pageConfig.canUsePromotionItem">KM </div>
                                <div class="col-discount cell" title="Chi·∫øt kh·∫•u c·ªßa m·ªôt s·∫£n ph·∫©m">CK/SP</div>
                                <div class="col-discount cell" title="= [%KM] * [gi√° tr·ªã tr∆∞·ªõc CK]">CK <br>nh√≥m </div>
                                <div class="col-discount cell" title="= [CK /SP] + [CK nh√≥m]">CK <br>d√≤ng </div>
                                <div class="col-discount cell" title="= [%CK] * ([gi√° tr·ªã tr∆∞·ªõc CK] - [CK d√≤ng])">CK <br>h√≥a ƒë∆°n </div>
                                <div class="col-price cell">ƒê∆°n gi√°</div>
                                <div class="col-total cell">Th√†nh ti·ªÅn</div>
                                <div class="col-discount cell" title="Chi·∫øt kh·∫•u c·ªßa nh√¢n vi√™n b√°n h√†ng" *ngIf="pageConfig.canUseDiscountFromSalesman">B√π gi√° </div>
                                <div class="col-discount cell" title="ƒê∆°n gi√° s·∫£n ph·∫©m sau khi t√≠nh b√π gi√°" *ngIf="pageConfig.canUseDiscountFromSalesman">ƒê∆°n gi√° <br> (sau b√π)</div>
                                <div class="col-total cell" title="[Kh√°ch ph·∫£i tr·∫£] = [Th√†nh ti·ªÅn] - [CK3]" *ngIf="pageConfig.canUseDiscountFromSalesman">Kh√°ch p.tr·∫£ </div>

                                <div class="col-del cell" *ngIf="pageConfig.canEdit"></div>
                            </header>

                            <div class="row" *ngFor="let i of item.OrderLines; let idx = index;">

                                <div class="col-id cell">{{idx+1}}</div>
                                <div class="col-name cell">
                                    <ng-select appendTo="#order-detail-page" [disabled]="!pageConfig.canEdit || submitAttempt" class="c-input" [(ngModel)]="i.IDItem" (change)="changedIDItem($event, i)" [labelForId]="'IDItem'+idx" [items]="itemList$ | async" [typeahead]="itemListInput$" [virtualScroll]="true" bindLabel="Name" bindValue="Id" placeholder="T√¨m t√™n ho·∫∑c m√£ s·∫£n ph·∫©m...">
                                        <ng-template ng-option-tmp let-i="item" let-search="searchTerm">
                                            <div *ngIf="i">
                                                <div><span [ngOptionHighlight]="search">{{i.Name}}</span></div>
                                                <small>#<b><span class="important" [ngOptionHighlight]="search">{{i.Id}} - {{i.Code}}</span></b></small>
                                            </div>
                                        </ng-template>
                                    </ng-select>
                                </div>
                                <div class="col-uom cell">
                                    <select [disabled]="!pageConfig.canEdit || submitAttempt" class="c-input c-dropdown" (change)="changedItemUoM(i)" [(ngModel)]="i.IDUoM" *ngIf="i._itemData && i._itemData.UoMs.length">
                                        <option value="">Ch·ªçn ƒë∆°n v·ªã</option>
                                        <option [disabled]="t.Flag" *ngFor="let t of i._itemData.UoMs" [value]="t.Id">{{t.Name}}</option>
                                    </select>
                                </div>

                                <div [ngClass]="{disable: !pageConfig.canEdit}" class="col-qty cell">
                                    <input [readonly]="!pageConfig.canEdit || submitAttempt" (focus)="$event.target.select()" *ngIf="i._itemData && i._itemData.UoMs.length && i.IDUoM" (change)="changedItemUoM(i)" class="c-input" type="number" [min]="i._UoM?i._UoM.MinQuantity:1" [max]="i._UoM?i._UoM.MaxQuantity:999" [(ngModel)]="i.Quantity" onkeydown="return event.keyCode !== 190">
                                </div>
                                <div [ngClass]="{disable: !pageConfig.canEdit || i.IsPromotionItem}" class="col-discount cell" *ngIf="pageConfig.canUseDiscountFromVendor">
                                    <input [readonly]="!pageConfig.canEdit || i.IsPromotionItem || submitAttempt" (focus)="$event.target.select()" *ngIf="i.Quantity" (change)="changedItemUoM(i)" class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscount1">
                                </div>
                                <div [ngClass]="{disable: !pageConfig.canEdit || i.IsPromotionItem}" class="col-discount cell" *ngIf="pageConfig.canUseDiscountFromDistributor">
                                    <input [readonly]="!pageConfig.canEdit || i.IsPromotionItem || submitAttempt" (focus)="$event.target.select()" *ngIf="i.Quantity" (change)="changedItemUoM(i)" class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscount2">
                                </div>

                                <div [ngClass]="{disable: !pageConfig.canEdit}" class="col-promotion cell" *ngIf="pageConfig.canUsePromotionItem">
                                    <input [disabled]="!pageConfig.canEdit || submitAttempt" (change)="changeIsPromotion(i);" class="c-checkbox" [(ngModel)]="i.IsPromotionItem" type="checkbox">
                                </div>


                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscountByItem">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscountByGroup">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscountByLine">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscountByOrder">
                                </div>
                                <div class="col-price cell disable" [ngClass]="{disable: !pageConfig.canEdit || !pageConfig.canEditPrice}">
                                    <input class="c-input" [readonly]="!(pageConfig.canEdit && pageConfig.canEditPrice && !i.IsPromotionItem)" (focus)="$event.target.select()" (change)="changedItemUoM(i)" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" [(ngModel)]="i.UoMPrice">
                                </div>

                                <div class="col-total cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalTotalAfterDiscount">
                                </div>

                                <div class="col-discount cell" [ngClass]="{disable: !pageConfig.canEdit}" *ngIf="pageConfig.canUseDiscountFromSalesman">
                                    <input *ngIf="i.Quantity && !i.IsPromotionItem" [readonly]="!(pageConfig.canEdit || (pageConfig.canUseDiscountFromSalesman && item.IDStatus == 103)) || submitAttempt || i.IsPromotionItem" (focus)="$event.target.select()"  (change)="changedItemUoM(i)" class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="i.IsPromotionItem" [(ngModel)]="i.OriginalDiscountFromSalesman">
                                </div>

                                <div class="col-discount cell" [ngClass]="{disable: !pageConfig.canEdit}" *ngIf="pageConfig.canUseDiscountFromSalesman">
                                    <input [readonly]="!(pageConfig.canEdit || (pageConfig.canUseDiscountFromSalesman && item.IDStatus == 103)) || submitAttempt" (focus)="$event.target.select()" *ngIf="i.Quantity" (change)="changedSalesmanPrice(i)" class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" [(ngModel)]="i.SalesmanPrice">
                                </div>

                                <div class="col-total cell" [ngClass]="{disable: !pageConfig.canEdit}" *ngIf="pageConfig.canUseDiscountFromSalesman">
                                    <input [readonly]="!(pageConfig.canEdit || (pageConfig.canUseDiscountFromSalesman && item.IDStatus == 103)) || submitAttempt" (focus)="$event.target.select()" *ngIf="i.Quantity" (change)="changedOriginalTotalAfterDiscountFromSalesman(i)" class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" [(ngModel)]="i.OriginalTotalAfterDiscountFromSalesman">
                                </div>

                                <div class="col-del cell" *ngIf="pageConfig.canEdit" (click)="deleteOrderLine(i)">
                                    <ion-icon color="danger" class="min-btn" name="trash-outline"></ion-icon>
                                </div>
                            </div>

                            <div class="row" *ngIf="item.Id && item?.OrderLines?.length > 1">
                                <div class="col-id cell" *ngIf="pageConfig.canEdit" (click)="addOrderLine()">
                                    <ion-icon class="min-btn" title="Th√™m s·∫£n ph·∫©m" name="add-circle-outline"></ion-icon>
                                </div>
                                <div class="col-id cell" *ngIf="!pageConfig.canEdit"></div>
                                <div class="col-name cell">
                                    <b (click)="addOrderLine()" *ngIf="pageConfig.canEdit">Th√™m s·∫£n ph·∫©m</b>
                                </div>
                                <div class="col-uom cell">
                                    <b>T·ªïng c·ªông:</b>
                                </div>

                                <div class="col-qty cell"></div>
                                <div class="col-discount cell disable" *ngIf="pageConfig.canUseDiscountFromVendor">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscount1">
                                </div>
                                <div class="col-discount cell disable" *ngIf="pageConfig.canUseDiscountFromDistributor">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscount2">
                                </div>

                                <div class="col-promotion cell disable" *ngIf="pageConfig.canUsePromotionItem">

                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscountByItem">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscountByGroup">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscountByLine">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscountByOrder">
                                </div>
                                <div class="col-price cell disable "></div>
                                <div class="col-total cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalTotalAfterTax">
                                </div>

                                <div class="col-discount cell disable" *ngIf="pageConfig.canUseDiscountFromSalesman">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscountFromSalesman">
                                </div>
                                <div class="col-discount cell disable" *ngIf="pageConfig.canUseDiscountFromSalesman">

                                </div>
                                <div class="col-total cell disable" *ngIf="pageConfig.canUseDiscountFromSalesman">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalTotalAfterDiscountFromSalesman">
                                </div>

                                <div class="col-del cell" *ngIf="pageConfig.canEdit"></div>
                            </div>

                        </section>
                    </div>
                    <div class="table-contain">
                        <div class="row" *ngIf="pageConfig.canEdit && item.Id && item?.OrderLines?.length < 2  ">
                            <div class="cell">
                                <ion-button fill="clear" size="small" (click)="addOrderLine()">
                                    <ion-icon slot="start" name="add-circle-outline"></ion-icon>
                                    Th√™m s·∫£n ph·∫©m
                                </ion-button>
                            </div>
                        </div>
                    </div>


                    <!-- <div class="ion-padding">

                        <ion-grid fixed *ngIf="OrderLines.controls.length">

                            <form [formGroup]="formGroup">
                                <ion-row [formGroup]="line" class="hr-group" *ngFor="let line of OrderLines.controls; let idx = index;">
                                    <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                                        <ion-list-header class="ion-no-padding">
                                            <ion-label color="primary">Line #{{idx+1}}</ion-label>
                                        </ion-list-header>
                                    </ion-col>
                                    <ion-col size-xs="12" size-sm="12" size-md="6" size-lg="6" size-xl="4">

                                        <div class="c-control">
                                            <label class="c-label" [for]="'IDItem'+idx">S·∫£n ph·∫©m <small>Item</small>
                                                <span *ngIf="!line.controls.IDItem.valid && !line.controls.IDItem.pending && (line.controls.IDItem.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>

                                            <ng-select class="c-input" (change)="changedIDItem($event)" #IDItem [labelForId]="'IDItem'+idx" formControlName="IDItem" [items]="itemList$ | async" [typeahead]="itemListInput$" [virtualScroll]="true" bindLabel="Name" bindValue="Id" placeholder="T√¨m t√™n ho·∫∑c m√£ s·∫£n ph·∫©m">
                                                <ng-template ng-option-tmp let-i="item" let-search="searchTerm">
                                                    <div *ngIf="i">
                                                        <div><span [ngOptionHighlight]="search">{{i.Name}}</span></div>
                                                        <small>#<b><span class="important" [ngOptionHighlight]="search">{{i.Id}} - {{i.Code}}</span></b></small>
                                                    </div>
                                                </ng-template>
                                            </ng-select>
                                        </div>

                                        <div class="c-control">
                                            <label class="c-label" [for]="'Quantity'+idx">S·ªë l∆∞·ª£ng
                                                <span *ngIf="!line.controls.Quantity.valid && !line.controls.Quantity.pending && (line.controls.Quantity.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <input (change)="saveChange()" class="c-input" [id]="'Quantity'+idx" formControlName="Quantity" type="number">
                                        </div>

                                    </ion-col>
                                    <ion-col size-xs="6" size-sm="6" size-md="3" size-lg="3" size-xl="2">

                                        <div class="c-control">
                                            <label class="c-label" [for]="'IDUoM'+idx">ƒê∆°n v·ªã t√≠nh</label>
                                            <input class="c-input" [id]="'IDUoM'+idx" formControlName="IDUoM">
                                        </div>

                                    </ion-col>
                                    <ion-col size-xs="6" size-sm="6" size-md="3" size-lg="3" size-sm size-xl="2">
                                        <div class="c-control">
                                            <label class="c-label" [for]="'UoMPrice'+idx">ƒê∆°n gi√°</label>
                                            <input class="c-input" [id]="'UoMPrice'+idx" formControlName="UoMPrice" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false">
                                        </div>

                                    </ion-col>
                                </ion-row>
                            </form>

                        </ion-grid>
                    </div> -->

                </div>
                <div *ngIf="segmentView == 's2'">

                </div>

                <div *ngIf="segmentView == 's3'">
                    <div class="ion-padding">

                        <ion-grid fixed>


                            <ion-row class="hr-group" *ngIf="contactSelected">
                                <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                                    <ion-list-header class="ion-no-padding">
                                        <ion-label color="primary">Th√¥ng tin kh√°ch h√†ng</ion-label>
                                    </ion-list-header>
                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">
                                    <div class="c-control">
                                        <label class="c-label">#Id <small><a [href]="'#/'+'business-partner/'+contactSelected.Id" (click)="nav('business-partner/'+contactSelected.Id,'forward')"> üîó xem th√™m...</a></small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.Id" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">M√£ (trong Union) <small>Code</small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.Code" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">ƒê·ªãa ch·ªâ<small>Address line 1</small>
                                            <small>
                                                <a *ngIf="!(contactSelected.Lat && contactSelected.Long)" target="_blank" [href]="'https://www.google.com/maps/search/'+contactSelected.AddressLine1"> üìç b·∫£n ƒë·ªì</a>
                                                <a *ngIf="contactSelected.Lat && contactSelected.Long" target="_blank" [href]="'https://www.google.com/maps/place/'+contactSelected.Lat+','+contactSelected.Long"> üìç b·∫£n ƒë·ªì</a>
                                            </small>
                                        </label>
                                        <textarea readonly class="c-input" [(ngModel)]="contactSelected.AddressLine1" [ngModelOptions]="{standalone: true}" type="textarea"></textarea>
                                    </div>


                                    <div class="c-control">
                                        <input id="IsPersonal1" disabled type="radio" [value]="true" [(ngModel)]="contactSelected.IsPersonal" [ngModelOptions]="{standalone: true}" class="c-checkbox">
                                        <label class="c-label radio" for="IsPersonal1">
                                            <span>C√° nh√¢n</span>
                                        </label>

                                        <input id="IsPersonal2" disabled type="radio" [value]="false" [(ngModel)]="contactSelected.IsPersonal" [ngModelOptions]="{standalone: true}" class="c-checkbox">
                                        <label class="c-label radio" for="IsPersonal2">
                                            <span>T·ªï ch·ª©c</span>
                                        </label>
                                    </div>

                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">
                                    <div class="c-control">
                                        <label class="c-label">T√™n g·ªçi</label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.Name" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <div class="c-control" *ngIf="!contactSelected.IsPersonal">
                                        <label class="c-label">T√™n c√¥ng ty / t·ªï ch·ª©c<small>Company name</small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.CompanyName" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <div class="c-control" *ngIf="!contactSelected.IsPersonal">
                                        <label class="c-label">M√£ s·ªë thu·∫ø <small>Tax code</small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.TaxCode" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>


                                    <div class="c-control">
                                        <label class="c-label">ƒêi·ªán tho·∫°i <small>WorkPhone</small> <small *ngIf="contactSelected.WorkPhone"><a [href]="'tel:'+contactSelected.WorkPhone"> ‚òè call</a></small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.WorkPhone" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">ƒêi·ªán tho·∫°i di ƒë·ªông<small>MobilePhone</small> <small *ngIf="contactSelected.MobilePhone"><a [href]="'tel:'+contactSelected.MobilePhone"> ‚òè call</a></small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.MobilePhone" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                </ion-col>
                            </ion-row>
                            <form [formGroup]="formGroup">
                                <ion-row class="hr-group">
                                    <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                                        <ion-list-header class="ion-no-padding">
                                            <ion-label color="primary">Th√¥ng tin ƒë∆°n h√†ng</ion-label>
                                        </ion-list-header>
                                    </ion-col>
                                    <ion-col size="12" size-sm size-xl="4">
                                        <div class="c-control">
                                            <label class="c-label" for="Code">M√£ <small>(M√£ Hƒê trong Union)</small>
                                                <span *ngIf="!formGroup.controls.Code.valid && !formGroup.controls.Code.pending && (formGroup.controls.Code.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <input (change)="saveChange()" class="c-input" id="Code" formControlName="Code" type="text">
                                        </div>
                                        <div class="c-control">
                                            <label class="c-label" for="Name">N·ªôi dung
                                                <span *ngIf="!formGroup.controls.Name.valid && !formGroup.controls.Name.pending && (formGroup.controls.Name.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <input (change)="saveChange()" class="c-input" id="Name" formControlName="Name" type="text">
                                        </div>

                                        <div class="c-control">
                                            <label class="c-label" for="IDStatus">T√¨nh tr·∫°ng ƒë∆°n h√†ng <small>IDStatus</small>
                                                <span *ngIf="!formGroup.controls.IDStatus.valid && !formGroup.controls.IDStatus.pending && (formGroup.controls.IDStatus.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select (change)="saveChange()" class="c-input c-dropdown" formControlName="IDStatus">
                                                <option *ngFor="let i of statusList" [value]="i.Id">{{i.Name}}</option>

                                            </select>
                                        </div>

                                        <div class="c-control" *ngIf="item.IDBranch">
                                            <label class="c-label" for="IDBranch">Chi nh√°nh <small>IDBranch</small>
                                                <span *ngIf="!formGroup.controls.IDBranch.valid && !formGroup.controls.IDBranch.pending && (formGroup.controls.IDBranch.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select (change)="saveChange()" class="c-input c-dropdown" formControlName="IDBranch">
                                                <option *ngIf="branch" [value]="branch.Id">{{branch.Name}}</option>
                                            </select>
                                        </div>

                                        <div class="c-control" *ngIf="item.IDOwner">
                                            <label class="c-label" for="IDOwner">Nh√¢n vi√™n b√°n h√†ng <small>IDOwner</small>
                                                <span *ngIf="!formGroup.controls.IDOwner.valid && !formGroup.controls.IDOwner.pending && (formGroup.controls.IDOwner.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select class="c-input c-dropdown" formControlName="IDOwner">
                                                <option *ngIf="saller" [value]="saller.Id">{{saller.FullName}}</option>
                                            </select>
                                        </div>

                                        <div class="c-control">
                                            <label class="c-label" for="SubType">Lo·∫°i ƒë∆°n h√†ng <small>Sub type</small>
                                                <span *ngIf="!formGroup.controls.SubType.valid && !formGroup.controls.SubType.pending && (formGroup.controls.SubType.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select class="c-input c-dropdown" formControlName="SubType">
                                                <option [value]="1">S·∫£n ph·∫©m tr∆∞ng b√†y</option>
                                                <option [value]="2">Pre Sales</option>
                                                <option [value]="2">C·∫≠n date</option>
                                            </select>
                                        </div>

                                        <!-- <div class="c-control">
                                            <label class="c-label" for="IDType">Lo·∫°i <small>Order type</small>
                                                <span *ngIf="!formGroup.controls.IDType.valid && !formGroup.controls.IDType.pending && (formGroup.controls.IDType.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select class="c-input c-dropdown" formControlName="IDType">
                                                <option [value]="1">Sales Order</option>
                                                <option [value]="2">Purchase Order</option>
                                                <option [value]="3">Ship Order</option>
                                                <option [value]="4">...</option>
                                            </select>
                                        </div> -->

                                        <!-- OriginalTotalBeforeDiscount decimal(18, 2) Unchecked
                                        OriginalPromotion decimal(18, 4) Unchecked
                                        OriginalDiscount1 decimal(18, 4) Unchecked
                                        OriginalDiscount2 decimal(18, 4) Unchecked
                                        OriginalDiscountByItem decimal(18, 4) Unchecked
                                        OriginalDiscountByGroup decimal(18, 4) Unchecked
                                        OriginalDiscountByLine decimal(18, 4) Unchecked
                                        OriginalDiscountByOrder decimal(18, 4) Unchecked
                                        OriginalTotalDiscount decimal(18, 2) Unchecked
                                        OriginalTotalAfterDiscount decimal(18, 2) Unchecked
                                        OriginalTax decimal(18, 2) Unchecked
                                        OriginalTotalAfterTax decimal(18, 4) Unchecked -->

                                        <!-- TotalBeforeDiscount decimal(18, 2) Unchecked
                                        Promotion decimal(18, 4) Unchecked
                                        Discount1 decimal(18, 4) Unchecked
                                        Discount2 decimal(18, 4) Unchecked
                                        DiscountByItem decimal(18, 4) Unchecked
                                        DiscountByGroup decimal(18, 4) Unchecked
                                        DiscountByLine decimal(18, 4) Unchecked
                                        DiscountByOrder decimal(18, 4) Unchecked
                                        TotalDiscount decimal(18, 2) Unchecked
                                        TotalAfterDiscount decimal(18, 4) Unchecked
                                        Tax decimal(18, 2) Unchecked
                                        TotalAfterTax decimal(18, 2) Unchecked -->



                                    </ion-col>
                                    <ion-col size="12" size-sm size-xl="4">


                                        <div class="c-control">
                                            <label class="c-label" for="IDOpportunity">Opportunity
                                                <span *ngIf="!formGroup.controls.IDOpportunity.valid && !formGroup.controls.IDOpportunity.pending && (formGroup.controls.IDOpportunity.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select class="c-input c-dropdown" formControlName="IDOpportunity">
                                                <option [value]="1">Opportunity 1</option>
                                            </select>
                                        </div>

                                        <div class="c-control">
                                            <label class="c-label" for="IDContract">H·ª£p ƒë·ªìng
                                                <span *ngIf="!formGroup.controls.IDContract.valid && !formGroup.controls.IDContract.pending && (formGroup.controls.IDContract.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select class="c-input c-dropdown" formControlName="IDContract">
                                                <option [value]="1">Contract 1</option>
                                            </select>
                                        </div>

                                        <div class="c-control">
                                            <label class="c-label">Ghi ch√∫<small>Remark</small></label>
                                            <textarea (change)="saveChange()" class="c-input" id="Remark" formControlName="Remark" type="textarea"></textarea>
                                        </div>

                                        <div class="c-control" *ngIf="item.Id">
                                            <input (change)="saveChange()" class="c-checkbox" id="IsDisabled" formControlName="IsDisabled" type="checkbox">
                                            <label class="c-label checkbox" for="IsDisabled">L∆∞u tr·ªØ
                                                <span *ngIf="!formGroup.controls.IsDisabled.valid && !formGroup.controls.IsDisabled.pending && (formGroup.controls.IsDisabled.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                        </div>
                                    </ion-col>
                                </ion-row>
                            </form>
                            <ion-row class="hr-group">
                                <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                                    <ion-list-header class="ion-no-padding">
                                        <ion-label color="primary">Th√¥ng tin v·∫≠n chuy·ªÉn</ion-label>
                                    </ion-list-header>
                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">

                                    <div class="c-control">
                                        <label class="c-label">M√£ v·∫≠n ƒë∆°n <small>Bill of lading (B/L)</small></label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.Code" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Tuy·∫øn ƒë∆∞·ªùng </label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.Route" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <div class="c-control">
                                        <label class="c-label">Nh√¢n vi√™n giao h√†ng </label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.Route" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">S·ªë xe </label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.VehicleNumber" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">
                                    <div class="c-control">
                                        <label class="c-label">Ng√†y d·ª± ki·∫øn giao h√†ng </label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.Route" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Ng√†y giao h√†ng <small>Shipped date</small> </label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.ShippedDate" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">ƒê·ªãa ch·ªâ<small>ShippingAddress</small></label>
                                        <textarea readonly class="c-input" [(ngModel)]="billOfLanding.ShippingAddress" [ngModelOptions]="{standalone: true}" type="textarea"></textarea>
                                    </div>
                                    <!-- <div class="c-control">
                                        <label class="c-label">Ghi ch√∫<small>ShippingAddressRemark</small></label>
                                        <textarea readonly class="c-input" [(ngModel)]="billOfLanding.ShippingAddressRemark" [ngModelOptions]="{standalone: true}" type="textarea"></textarea>
                                    </div> -->



                                </ion-col>
                            </ion-row>
                            <ion-row class="hr-group">
                                <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                                    <ion-list-header class="ion-no-padding">
                                        <ion-label color="primary">Ch·ª©ng t·ª´ / c√¥ng n·ª£</ion-label>
                                    </ion-list-header>
                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">

                                    <div class="c-control">
                                        <label class="c-label">T·ªïng c·ªông <small>TotalAfterTax</small></label>
                                        <input readonly class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" suffix=" ‚Ç´" [(ngModel)]="item.OriginalTotalAfterTax" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <div class="c-control">
                                        <label class="c-label">ƒê√£ nh·∫≠n <small>Received</small></label>
                                        <input readonly class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" suffix=" ‚Ç´" [(ngModel)]="item.Received" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <div class="c-control">
                                        <label class="c-label">C√≤n n·ª£ <small>Debt</small></label>
                                        <input readonly class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" suffix=" ‚Ç´" [(ngModel)]="item.Debt" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <!-- IsDebt bit Unchecked -->
                                    <!-- IsPaymentReceived bit Unchecked -->

                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">
                                    <div class="c-control">
                                        <label class="c-label">H√≥a ƒë∆°n</label>
                                        <input readonly class="c-input" [(ngModel)]="item.InvoiceNumber" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Ng√†y h√≥a ƒë∆°n </label>
                                        <input readonly class="c-input" [(ngModel)]="item.InvoicDate" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Thu·∫ø <small>TaxRate</small></label>
                                        <input readonly class="c-input" [(ngModel)]="item.TaxRate" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                </ion-col>
                            </ion-row>

                        </ion-grid>
                    </div>

                </div>

                <div *ngIf="segmentView == 's4'">

                </div>

                <div *ngIf="segmentView == 's5'">

                </div>

                <div *ngIf="segmentView == 's6'">

                </div>
            </div>
        </div>
    </div>

    <app-page-message [itemsLength]="item? 1: 0" [showSpinner]="pageConfig.showSpinner"></app-page-message>


</ion-content>