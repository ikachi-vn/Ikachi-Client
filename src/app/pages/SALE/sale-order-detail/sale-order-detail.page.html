<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="sale-order"></ion-back-button>
            <ion-button color="dark" class="ion-hide-sm-down">
                Đơn hàng
            </ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
            <app-detail-toolbar [item]="item" [pageConfig]="pageConfig" (refresh)="refresh()" (delete)="delete()" (help)="help()"></app-detail-toolbar>
        </ion-buttons>
    </ion-toolbar>
</ion-header>


<ion-content appScrollbarTheme class="ion-padding">
    <div id="order-detail-page" style="position: absolute;"></div>
    <div class="main-view" *ngIf="item && pageConfig.showSpinner==false">
        <ion-grid fixed>
            <form [formGroup]="formGroup">
                <ion-row class="hr-group">
                    <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                        <ion-list-header class="ion-no-padding">
                            <ion-label color="primary">Đơn hàng</ion-label>
                        </ion-list-header>
                    </ion-col>
                    <ion-col size="12" size-sm size-xl="4">

                        <div class="c-control" *ngIf="item.Id">
                            <label class="c-label" for="Id"># Id</label>
                            <input class="c-input" id="Id" formControlName="Id" type="number">
                        </div>

                        <div class="c-control">
                            <label class="c-label" for="IDAddress">Khách hàng <small>{{item.IDContact}}</small>
                                <span *ngIf="!formGroup.controls.IDAddress.valid && !formGroup.controls.IDAddress.pending && (formGroup.controls.IDAddress.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                            </label>
                            <ng-select class="c-input" (change)="changedIDAddress($event)" #IDAddress labelForId="IDAddress" formControlName="IDAddress" [items]="contactList$ | async" [typeahead]="contactListInput$" [loading]='contactListLoading' [virtualScroll]="true" bindLabel="Name" bindValue="IDAddress" placeholder="Tìm tên, mã hoặc số điện thoại...">
                                <ng-template ng-label-tmp let-i="item" let-a="item.Address">
                                    {{i.Name}}
                                    <small *ngIf="a">
                                        <span *ngIf="a.AddressLine1"> | {{a.AddressLine1}}</span>
                                        <span *ngIf="a.Ward">, {{a.Ward}}</span>
                                        <span *ngIf="a.District">, {{a.District}}</span>
                                        <span *ngIf="a.Province">, {{a.Province}}</span>
                                    </small>
                                </ng-template>
                                <ng-template ng-option-tmp let-i="item" let-a="item.Address" let-search="searchTerm">
                                    <div *ngIf="i">
                                        <div>
                                            <span [ngOptionHighlight]="search">{{i.Name}}</span>
                                            <span *ngIf="i.WorkPhone"> | <small> <b [ngOptionHighlight]="search">{{i.WorkPhone}}</b> </small></span>
                                        </div>
                                        <small *ngIf="a">
                                            <b *ngIf="i.Code"><span class="important" [ngOptionHighlight]="search">{{i.Code}}</span></b>
                                            <span *ngIf="a.AddressLine1"> | {{a.AddressLine1}}</span>
                                            <span *ngIf="a.Ward">, {{a.Ward}}</span>
                                            <span *ngIf="a.District">, {{a.District}}</span>
                                            <span *ngIf="a.Province">, {{a.Province}}</span>
                                            <br *ngIf="a.AddressLine2 || a.Contact">
                                            <span *ngIf="a.AddressLine2">{{a.AddressLine2}}</span>
                                            <span *ngIf="a.Contact"> | Liên hệ: {{a.Contact}}</span>
                                            <span *ngIf="a.Phone1"> - {{a.Phone1}}</span>
                                            <span *ngIf="a.Phone2"> - {{a.Phone2}}</span>
                                        </small>
                                    </div>
                                </ng-template>
                            </ng-select>
                        </div>

                        <div class="c-control">
                            <label class="c-label" for="OriginalTotalAfterTax">Tổng tiền <small>OriginalTotalAfterTax</small>
                                <span *ngIf="!formGroup.controls.OriginalTotalAfterTax.valid && !formGroup.controls.OriginalTotalAfterTax.pending && (formGroup.controls.OriginalTotalAfterTax.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                            </label>
                            <input (change)="saveChange()" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" suffix=" ₫" class="c-input" id="OriginalTotalAfterTax" formControlName="OriginalTotalAfterTax" type="text">
                        </div>

                        <div class="c-control" *ngIf="item.OriginalTotalAfterDiscountFromSalesman != item.OriginalTotalAfterDiscount">
                            <label class="c-label" for="OriginalTotalAfterDiscountFromSalesman">Tổng tiền khách trả</label>
                            <input [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" suffix=" ₫" class="c-input" id="OriginalTotalAfterDiscountFromSalesman" [ngModelOptions]="{standalone: true}" [ngModel]="item.OriginalTotalAfterDiscountFromSalesman" type="text">
                        </div>

                    </ion-col>
                    <ion-col size="12" size-sm size-xl="4">
                        <div class="c-control" *ngIf="item.Id">
                            <label class="c-label">Ngày lên đơn <small>OrderDate</small></label>

                            <span class="c-input disable">{{item.OrderDateText}}</span>
                        </div>

                        <div class="c-control">
                            <label class="c-label" for="ProductWeight">Khối lượng <small>ProductWeight</small>
                                <span *ngIf="!formGroup.controls.ProductWeight.valid && !formGroup.controls.ProductWeight.pending && (formGroup.controls.ProductWeight.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                            </label>
                            <input readonly class="c-input" id="ProductWeight" formControlName="ProductWeight" type='text' mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" suffix=" kg">
                        </div>

                        <div class="c-control">
                            <label class="c-label" for="ProductDimensions">Thể tích <small>Volume </small> &nbsp;&nbsp; <ion-text color="primary" *ngIf="item.ProductDimensionsM">{{item.ProductDimensionsM | mask: 'separator.2':','}} m³</ion-text>
                                <span *ngIf="!formGroup.controls.ProductDimensions.valid && !formGroup.controls.ProductDimensions.pending && (formGroup.controls.ProductDimensions.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                            </label>

                            <input readonly class="c-input" id="ProductDimensions" formControlName="ProductDimensions" type='text' mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" suffix=" cm³">
                        </div>


                        <!-- <div class="c-control">
                            <label class="c-label" for=""></label>
                            <ion-button *ngIf="!item.Id && pageConfig.canAdd" expand="block" (click)="saveChange()" [disabled]="!formGroup.dirty">Thêm đơn hàng</ion-button>
                        </div> -->

                        <div class="c-control ion-text-right">
                            <ion-button size="small" [disabled]="!(pageConfig.canEdit || (this.pageConfig.canChangeTypeOfReviewOrder && this.item.IDStatus == 103)) || submitAttempt" (click)="item.IsSampleOrder = !item.IsSampleOrder; changedSampleOrder()" [fill]=" item.IsSampleOrder? 'solid' : 'outline' ">
                                Sample
                            </ion-button>
                            <ion-button size="small" [disabled]="!(pageConfig.canEdit || (this.pageConfig.canChangeTypeOfReviewOrder && this.item.IDStatus == 103)) || submitAttempt" (click)="item.IsShipBySaleMan = !item.IsShipBySaleMan; saveChange()" [fill]=" item.IsShipBySaleMan? 'solid' : 'outline' ">
                                Bao phủ
                            </ion-button>
                            <ion-button size="small" [disabled]="!(pageConfig.canEdit || (this.pageConfig.canChangeTypeOfReviewOrder && this.item.IDStatus == 103)) || submitAttempt" (click)="item.IsUrgentOrders = !item.IsUrgentOrders; saveChange()" [fill]=" item.IsUrgentOrders? 'solid' : 'outline' ">
                                Giao gấp
                            </ion-button>
                            <ion-button size="small" [disabled]="!(pageConfig.canEdit || (this.pageConfig.canChangeTypeOfReviewOrder && this.item.IDStatus == 103)) || submitAttempt" (click)="item.IsWholeSale = !item.IsWholeSale; saveChange()" [fill]=" item.IsWholeSale? 'solid' : 'outline' ">
                                Khách sỉ
                            </ion-button>
                        </div>

                    </ion-col>
                </ion-row>

                <!-- <ion-row class="hr-group">
                    <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                        <ion-list-header class="ion-no-padding">
                            <ion-label color="primary">Thông tin sản phẩm</ion-label>
                        </ion-list-header>
                    </ion-col>
                    <ion-col size="12" size-sm size-xl="4">
                        

                    </ion-col>
                    <ion-col size="12" size-sm size-xl="4">
                        
                    </ion-col>
                </ion-row> -->

            </form>
        </ion-grid>



        <div class="row-full shadow full-screen">
            <ion-toolbar color="primary">
                <ion-segment scrollable="true" (ionChange)="segmentChanged($event)" [value]="segmentView">

                    <ion-segment-button value="s1">
                        <ion-label>Danh sách sản phẩm</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="s2">
                        <ion-label>Khuyến mãi / CK áp dụng</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="s3">
                        <ion-label>Thông tin khác</ion-label>
                    </ion-segment-button>

                </ion-segment>
            </ion-toolbar>

            <div>
                <div *ngIf="segmentView == 's1'">

                    <div class="table-contain">
                        <section class="table" style="min-width: 1340px;">
                            <header class="bold">
                                <div class="col-id cell">#</div>
                                <div class="col-name cell">Sản phẩn</div>
                                <div class="col-uom cell">Đơn vị</div>
                                <div class="col-qty cell">Số lượng</div>
                                <div class="col-discount cell" title="Chiết khấu của hãng" *ngIf="pageConfig.canUseDiscountFromVendor">CK1 </div>
                                <div class="col-discount cell" title="Chiết khấu của nhà phân phối" *ngIf="pageConfig.canUseDiscountFromDistributor">CK2 </div>

                                <div class="col-promotion cell" title="Là hàng khuyến mãi" *ngIf="pageConfig.canUsePromotionItem">KM </div>
                                <div class="col-discount cell" title="Chiết khấu của một sản phẩm">CK/SP</div>
                                <div class="col-discount cell" title="= [%KM] * [giá trị trước CK]">CK <br>nhóm </div>
                                <div class="col-discount cell" title="= [CK /SP] + [CK nhóm]">CK <br>dòng </div>
                                <div class="col-discount cell" title="= [%CK] * ([giá trị trước CK] - [CK dòng])">CK <br>hóa đơn </div>
                                <div class="col-price cell">Đơn giá</div>
                                <div class="col-total cell">Thành tiền</div>
                                <div class="col-discount cell" title="Chiết khấu của nhân viên bán hàng" *ngIf="pageConfig.canUseDiscountFromSalesman">Bù giá </div>
                                <div class="col-discount cell" title="Đơn giá sản phẩm sau khi tính bù giá" *ngIf="pageConfig.canUseDiscountFromSalesman">Đơn giá <br> (sau bù)</div>
                                <div class="col-total cell" title="[Khách phải trả] = [Thành tiền] - [CK3]" *ngIf="pageConfig.canUseDiscountFromSalesman">Khách p.trả </div>

                                <div class="col-del cell" *ngIf="pageConfig.canEdit"></div>
                            </header>

                            <div class="row" *ngFor="let i of item.OrderLines; let idx = index;">

                                <div class="col-id cell">{{idx+1}}</div>
                                <div class="col-name cell">
                                    <ng-select appendTo="#order-detail-page" [disabled]="!pageConfig.canEdit || submitAttempt" class="c-input" [(ngModel)]="i.IDItem" (change)="changedIDItem($event, i)" [labelForId]="'IDItem'+idx" [items]="itemList$ | async" [typeahead]="itemListInput$" [virtualScroll]="true" bindLabel="Name" bindValue="Id" placeholder="Tìm tên hoặc mã sản phẩm...">
                                        <ng-template ng-option-tmp let-i="item" let-search="searchTerm">
                                            <div *ngIf="i">
                                                <div><span [ngOptionHighlight]="search">{{i.Name}}</span></div>
                                                <small>#<b><span class="important" [ngOptionHighlight]="search">{{i.Id}} - {{i.Code}}</span></b></small>
                                            </div>
                                        </ng-template>
                                    </ng-select>
                                </div>
                                <div class="col-uom cell">
                                    <select [disabled]="!pageConfig.canEdit || submitAttempt" class="c-input c-dropdown" (change)="changedItemUoM(i)" [(ngModel)]="i.IDUoM" *ngIf="i._itemData && i._itemData.UoMs.length">
                                        <option value="">Chọn đơn vị</option>
                                        <option [disabled]="t.Flag" *ngFor="let t of i._itemData.UoMs" [value]="t.Id">{{t.Name}}</option>
                                    </select>
                                </div>

                                <div [ngClass]="{disable: !pageConfig.canEdit}" class="col-qty cell">
                                    <input [readonly]="!pageConfig.canEdit || submitAttempt" (focus)="$event.target.select()" *ngIf="i._itemData && i._itemData.UoMs.length && i.IDUoM" (change)="changedItemUoM(i)" class="c-input" type="number" [min]="i._UoM?i._UoM.MinQuantity:1" [max]="i._UoM?i._UoM.MaxQuantity:999" [(ngModel)]="i.Quantity" onkeydown="return event.keyCode !== 190">
                                </div>
                                <div [ngClass]="{disable: !pageConfig.canEdit || i.IsPromotionItem}" class="col-discount cell" *ngIf="pageConfig.canUseDiscountFromVendor">
                                    <input [readonly]="!pageConfig.canEdit || i.IsPromotionItem || submitAttempt" (focus)="$event.target.select()" *ngIf="i.Quantity" (change)="changedItemUoM(i)" class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscount1">
                                </div>
                                <div [ngClass]="{disable: !pageConfig.canEdit || i.IsPromotionItem}" class="col-discount cell" *ngIf="pageConfig.canUseDiscountFromDistributor">
                                    <input [readonly]="!pageConfig.canEdit || i.IsPromotionItem || submitAttempt" (focus)="$event.target.select()" *ngIf="i.Quantity" (change)="changedItemUoM(i)" class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscount2">
                                </div>

                                <div [ngClass]="{disable: !pageConfig.canEdit}" class="col-promotion cell" *ngIf="pageConfig.canUsePromotionItem">
                                    <input [disabled]="!pageConfig.canEdit || submitAttempt" (change)="changeIsPromotion(i);" class="c-checkbox" [(ngModel)]="i.IsPromotionItem" type="checkbox">
                                </div>


                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscountByItem">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscountByGroup">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscountByLine">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalDiscountByOrder">
                                </div>
                                <div class="col-price cell disable" [ngClass]="{disable: !pageConfig.canEdit || !pageConfig.canEditPrice}">
                                    <input class="c-input" [readonly]="!(pageConfig.canEdit && pageConfig.canEditPrice && !i.IsPromotionItem)" (focus)="$event.target.select()" (change)="changedItemUoM(i)" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" [(ngModel)]="i.UoMPrice">
                                </div>

                                <div class="col-total cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [(ngModel)]="i.OriginalTotalAfterDiscount">
                                </div>

                                <div class="col-discount cell" [ngClass]="{disable: !pageConfig.canEdit}" *ngIf="pageConfig.canUseDiscountFromSalesman">
                                    <input *ngIf="i.Quantity && !i.IsPromotionItem" [readonly]="!(pageConfig.canEdit || (pageConfig.canUseDiscountFromSalesman && item.IDStatus == 103)) || submitAttempt || i.IsPromotionItem" (focus)="$event.target.select()"  (change)="changedItemUoM(i)" class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="i.IsPromotionItem" [(ngModel)]="i.OriginalDiscountFromSalesman">
                                </div>

                                <div class="col-discount cell" [ngClass]="{disable: !pageConfig.canEdit}" *ngIf="pageConfig.canUseDiscountFromSalesman">
                                    <input [readonly]="!(pageConfig.canEdit || (pageConfig.canUseDiscountFromSalesman && item.IDStatus == 103)) || submitAttempt" (focus)="$event.target.select()" *ngIf="i.Quantity" (change)="changedSalesmanPrice(i)" class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" [(ngModel)]="i.SalesmanPrice">
                                </div>

                                <div class="col-total cell" [ngClass]="{disable: !pageConfig.canEdit}" *ngIf="pageConfig.canUseDiscountFromSalesman">
                                    <input [readonly]="!(pageConfig.canEdit || (pageConfig.canUseDiscountFromSalesman && item.IDStatus == 103)) || submitAttempt" (focus)="$event.target.select()" *ngIf="i.Quantity" (change)="changedOriginalTotalAfterDiscountFromSalesman(i)" class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" [(ngModel)]="i.OriginalTotalAfterDiscountFromSalesman">
                                </div>

                                <div class="col-del cell" *ngIf="pageConfig.canEdit" (click)="deleteOrderLine(i)">
                                    <ion-icon color="danger" class="min-btn" name="trash-outline"></ion-icon>
                                </div>
                            </div>

                            <div class="row" *ngIf="item.Id && item?.OrderLines?.length > 1">
                                <div class="col-id cell" *ngIf="pageConfig.canEdit" (click)="addOrderLine()">
                                    <ion-icon class="min-btn" title="Thêm sản phẩm" name="add-circle-outline"></ion-icon>
                                </div>
                                <div class="col-id cell" *ngIf="!pageConfig.canEdit"></div>
                                <div class="col-name cell">
                                    <b (click)="addOrderLine()" *ngIf="pageConfig.canEdit">Thêm sản phẩm</b>
                                </div>
                                <div class="col-uom cell">
                                    <b>Tổng cộng:</b>
                                </div>

                                <div class="col-qty cell"></div>
                                <div class="col-discount cell disable" *ngIf="pageConfig.canUseDiscountFromVendor">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscount1">
                                </div>
                                <div class="col-discount cell disable" *ngIf="pageConfig.canUseDiscountFromDistributor">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscount2">
                                </div>

                                <div class="col-promotion cell disable" *ngIf="pageConfig.canUsePromotionItem">

                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscountByItem">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscountByGroup">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscountByLine">
                                </div>
                                <div class="col-discount cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscountByOrder">
                                </div>
                                <div class="col-price cell disable "></div>
                                <div class="col-total cell disable">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalTotalAfterTax">
                                </div>

                                <div class="col-discount cell disable" *ngIf="pageConfig.canUseDiscountFromSalesman">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalDiscountFromSalesman">
                                </div>
                                <div class="col-discount cell disable" *ngIf="pageConfig.canUseDiscountFromSalesman">

                                </div>
                                <div class="col-total cell disable" *ngIf="pageConfig.canUseDiscountFromSalesman">
                                    <input class="c-input" [disabled]="true" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="true" [ngModel]="item.OriginalTotalAfterDiscountFromSalesman">
                                </div>

                                <div class="col-del cell" *ngIf="pageConfig.canEdit"></div>
                            </div>

                        </section>
                    </div>
                    <div class="table-contain">
                        <div class="row" *ngIf="pageConfig.canEdit && item.Id && item?.OrderLines?.length < 2  ">
                            <div class="cell">
                                <ion-button fill="clear" size="small" (click)="addOrderLine()">
                                    <ion-icon slot="start" name="add-circle-outline"></ion-icon>
                                    Thêm sản phẩm
                                </ion-button>
                            </div>
                        </div>
                    </div>


                    <!-- <div class="ion-padding">

                        <ion-grid fixed *ngIf="OrderLines.controls.length">

                            <form [formGroup]="formGroup">
                                <ion-row [formGroup]="line" class="hr-group" *ngFor="let line of OrderLines.controls; let idx = index;">
                                    <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                                        <ion-list-header class="ion-no-padding">
                                            <ion-label color="primary">Line #{{idx+1}}</ion-label>
                                        </ion-list-header>
                                    </ion-col>
                                    <ion-col size-xs="12" size-sm="12" size-md="6" size-lg="6" size-xl="4">

                                        <div class="c-control">
                                            <label class="c-label" [for]="'IDItem'+idx">Sản phẩm <small>Item</small>
                                                <span *ngIf="!line.controls.IDItem.valid && !line.controls.IDItem.pending && (line.controls.IDItem.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>

                                            <ng-select class="c-input" (change)="changedIDItem($event)" #IDItem [labelForId]="'IDItem'+idx" formControlName="IDItem" [items]="itemList$ | async" [typeahead]="itemListInput$" [virtualScroll]="true" bindLabel="Name" bindValue="Id" placeholder="Tìm tên hoặc mã sản phẩm">
                                                <ng-template ng-option-tmp let-i="item" let-search="searchTerm">
                                                    <div *ngIf="i">
                                                        <div><span [ngOptionHighlight]="search">{{i.Name}}</span></div>
                                                        <small>#<b><span class="important" [ngOptionHighlight]="search">{{i.Id}} - {{i.Code}}</span></b></small>
                                                    </div>
                                                </ng-template>
                                            </ng-select>
                                        </div>

                                        <div class="c-control">
                                            <label class="c-label" [for]="'Quantity'+idx">Số lượng
                                                <span *ngIf="!line.controls.Quantity.valid && !line.controls.Quantity.pending && (line.controls.Quantity.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <input (change)="saveChange()" class="c-input" [id]="'Quantity'+idx" formControlName="Quantity" type="number">
                                        </div>

                                    </ion-col>
                                    <ion-col size-xs="6" size-sm="6" size-md="3" size-lg="3" size-xl="2">

                                        <div class="c-control">
                                            <label class="c-label" [for]="'IDUoM'+idx">Đơn vị tính</label>
                                            <input class="c-input" [id]="'IDUoM'+idx" formControlName="IDUoM">
                                        </div>

                                    </ion-col>
                                    <ion-col size-xs="6" size-sm="6" size-md="3" size-lg="3" size-sm size-xl="2">
                                        <div class="c-control">
                                            <label class="c-label" [for]="'UoMPrice'+idx">Đơn giá</label>
                                            <input class="c-input" [id]="'UoMPrice'+idx" formControlName="UoMPrice" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false">
                                        </div>

                                    </ion-col>
                                </ion-row>
                            </form>

                        </ion-grid>
                    </div> -->

                </div>
                <div *ngIf="segmentView == 's2'">

                </div>

                <div *ngIf="segmentView == 's3'">
                    <div class="ion-padding">

                        <ion-grid fixed>


                            <ion-row class="hr-group" *ngIf="contactSelected">
                                <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                                    <ion-list-header class="ion-no-padding">
                                        <ion-label color="primary">Thông tin khách hàng</ion-label>
                                    </ion-list-header>
                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">
                                    <div class="c-control">
                                        <label class="c-label">#Id <small><a [href]="'#/'+'business-partner/'+contactSelected.Id" (click)="nav('business-partner/'+contactSelected.Id,'forward')"> 🔗 xem thêm...</a></small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.Id" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Mã (trong Union) <small>Code</small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.Code" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Địa chỉ<small>Address line 1</small>
                                            <small>
                                                <a *ngIf="!(contactSelected.Lat && contactSelected.Long)" target="_blank" [href]="'https://www.google.com/maps/search/'+contactSelected.AddressLine1"> 📍 bản đồ</a>
                                                <a *ngIf="contactSelected.Lat && contactSelected.Long" target="_blank" [href]="'https://www.google.com/maps/place/'+contactSelected.Lat+','+contactSelected.Long"> 📍 bản đồ</a>
                                            </small>
                                        </label>
                                        <textarea readonly class="c-input" [(ngModel)]="contactSelected.AddressLine1" [ngModelOptions]="{standalone: true}" type="textarea"></textarea>
                                    </div>


                                    <div class="c-control">
                                        <input id="IsPersonal1" disabled type="radio" [value]="true" [(ngModel)]="contactSelected.IsPersonal" [ngModelOptions]="{standalone: true}" class="c-checkbox">
                                        <label class="c-label radio" for="IsPersonal1">
                                            <span>Cá nhân</span>
                                        </label>

                                        <input id="IsPersonal2" disabled type="radio" [value]="false" [(ngModel)]="contactSelected.IsPersonal" [ngModelOptions]="{standalone: true}" class="c-checkbox">
                                        <label class="c-label radio" for="IsPersonal2">
                                            <span>Tổ chức</span>
                                        </label>
                                    </div>

                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">
                                    <div class="c-control">
                                        <label class="c-label">Tên gọi</label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.Name" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <div class="c-control" *ngIf="!contactSelected.IsPersonal">
                                        <label class="c-label">Tên công ty / tổ chức<small>Company name</small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.CompanyName" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <div class="c-control" *ngIf="!contactSelected.IsPersonal">
                                        <label class="c-label">Mã số thuế <small>Tax code</small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.TaxCode" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>


                                    <div class="c-control">
                                        <label class="c-label">Điện thoại <small>WorkPhone</small> <small *ngIf="contactSelected.WorkPhone"><a [href]="'tel:'+contactSelected.WorkPhone"> ☏ call</a></small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.WorkPhone" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Điện thoại di động<small>MobilePhone</small> <small *ngIf="contactSelected.MobilePhone"><a [href]="'tel:'+contactSelected.MobilePhone"> ☏ call</a></small></label>
                                        <input readonly class="c-input" [(ngModel)]="contactSelected.MobilePhone" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                </ion-col>
                            </ion-row>
                            <form [formGroup]="formGroup">
                                <ion-row class="hr-group">
                                    <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                                        <ion-list-header class="ion-no-padding">
                                            <ion-label color="primary">Thông tin đơn hàng</ion-label>
                                        </ion-list-header>
                                    </ion-col>
                                    <ion-col size="12" size-sm size-xl="4">
                                        <div class="c-control">
                                            <label class="c-label" for="Code">Mã <small>(Mã HĐ trong Union)</small>
                                                <span *ngIf="!formGroup.controls.Code.valid && !formGroup.controls.Code.pending && (formGroup.controls.Code.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <input (change)="saveChange()" class="c-input" id="Code" formControlName="Code" type="text">
                                        </div>
                                        <div class="c-control">
                                            <label class="c-label" for="Name">Nội dung
                                                <span *ngIf="!formGroup.controls.Name.valid && !formGroup.controls.Name.pending && (formGroup.controls.Name.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <input (change)="saveChange()" class="c-input" id="Name" formControlName="Name" type="text">
                                        </div>

                                        <div class="c-control">
                                            <label class="c-label" for="IDStatus">Tình trạng đơn hàng <small>IDStatus</small>
                                                <span *ngIf="!formGroup.controls.IDStatus.valid && !formGroup.controls.IDStatus.pending && (formGroup.controls.IDStatus.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select (change)="saveChange()" class="c-input c-dropdown" formControlName="IDStatus">
                                                <option *ngFor="let i of statusList" [value]="i.Id">{{i.Name}}</option>

                                            </select>
                                        </div>

                                        <div class="c-control" *ngIf="item.IDBranch">
                                            <label class="c-label" for="IDBranch">Chi nhánh <small>IDBranch</small>
                                                <span *ngIf="!formGroup.controls.IDBranch.valid && !formGroup.controls.IDBranch.pending && (formGroup.controls.IDBranch.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select (change)="saveChange()" class="c-input c-dropdown" formControlName="IDBranch">
                                                <option *ngIf="branch" [value]="branch.Id">{{branch.Name}}</option>
                                            </select>
                                        </div>

                                        <div class="c-control" *ngIf="item.IDOwner">
                                            <label class="c-label" for="IDOwner">Nhân viên bán hàng <small>IDOwner</small>
                                                <span *ngIf="!formGroup.controls.IDOwner.valid && !formGroup.controls.IDOwner.pending && (formGroup.controls.IDOwner.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select class="c-input c-dropdown" formControlName="IDOwner">
                                                <option *ngIf="saller" [value]="saller.Id">{{saller.FullName}}</option>
                                            </select>
                                        </div>

                                        <div class="c-control">
                                            <label class="c-label" for="SubType">Loại đơn hàng <small>Sub type</small>
                                                <span *ngIf="!formGroup.controls.SubType.valid && !formGroup.controls.SubType.pending && (formGroup.controls.SubType.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select class="c-input c-dropdown" formControlName="SubType">
                                                <option [value]="1">Sản phẩm trưng bày</option>
                                                <option [value]="2">Pre Sales</option>
                                                <option [value]="2">Cận date</option>
                                            </select>
                                        </div>

                                        <!-- <div class="c-control">
                                            <label class="c-label" for="IDType">Loại <small>Order type</small>
                                                <span *ngIf="!formGroup.controls.IDType.valid && !formGroup.controls.IDType.pending && (formGroup.controls.IDType.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select class="c-input c-dropdown" formControlName="IDType">
                                                <option [value]="1">Sales Order</option>
                                                <option [value]="2">Purchase Order</option>
                                                <option [value]="3">Ship Order</option>
                                                <option [value]="4">...</option>
                                            </select>
                                        </div> -->

                                        <!-- OriginalTotalBeforeDiscount decimal(18, 2) Unchecked
                                        OriginalPromotion decimal(18, 4) Unchecked
                                        OriginalDiscount1 decimal(18, 4) Unchecked
                                        OriginalDiscount2 decimal(18, 4) Unchecked
                                        OriginalDiscountByItem decimal(18, 4) Unchecked
                                        OriginalDiscountByGroup decimal(18, 4) Unchecked
                                        OriginalDiscountByLine decimal(18, 4) Unchecked
                                        OriginalDiscountByOrder decimal(18, 4) Unchecked
                                        OriginalTotalDiscount decimal(18, 2) Unchecked
                                        OriginalTotalAfterDiscount decimal(18, 2) Unchecked
                                        OriginalTax decimal(18, 2) Unchecked
                                        OriginalTotalAfterTax decimal(18, 4) Unchecked -->

                                        <!-- TotalBeforeDiscount decimal(18, 2) Unchecked
                                        Promotion decimal(18, 4) Unchecked
                                        Discount1 decimal(18, 4) Unchecked
                                        Discount2 decimal(18, 4) Unchecked
                                        DiscountByItem decimal(18, 4) Unchecked
                                        DiscountByGroup decimal(18, 4) Unchecked
                                        DiscountByLine decimal(18, 4) Unchecked
                                        DiscountByOrder decimal(18, 4) Unchecked
                                        TotalDiscount decimal(18, 2) Unchecked
                                        TotalAfterDiscount decimal(18, 4) Unchecked
                                        Tax decimal(18, 2) Unchecked
                                        TotalAfterTax decimal(18, 2) Unchecked -->



                                    </ion-col>
                                    <ion-col size="12" size-sm size-xl="4">


                                        <div class="c-control">
                                            <label class="c-label" for="IDOpportunity">Opportunity
                                                <span *ngIf="!formGroup.controls.IDOpportunity.valid && !formGroup.controls.IDOpportunity.pending && (formGroup.controls.IDOpportunity.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select class="c-input c-dropdown" formControlName="IDOpportunity">
                                                <option [value]="1">Opportunity 1</option>
                                            </select>
                                        </div>

                                        <div class="c-control">
                                            <label class="c-label" for="IDContract">Hợp đồng
                                                <span *ngIf="!formGroup.controls.IDContract.valid && !formGroup.controls.IDContract.pending && (formGroup.controls.IDContract.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                            <select class="c-input c-dropdown" formControlName="IDContract">
                                                <option [value]="1">Contract 1</option>
                                            </select>
                                        </div>

                                        <div class="c-control">
                                            <label class="c-label">Ghi chú<small>Remark</small></label>
                                            <textarea (change)="saveChange()" class="c-input" id="Remark" formControlName="Remark" type="textarea"></textarea>
                                        </div>

                                        <div class="c-control" *ngIf="item.Id">
                                            <input (change)="saveChange()" class="c-checkbox" id="IsDisabled" formControlName="IsDisabled" type="checkbox">
                                            <label class="c-label checkbox" for="IsDisabled">Lưu trữ
                                                <span *ngIf="!formGroup.controls.IsDisabled.valid && !formGroup.controls.IsDisabled.pending && (formGroup.controls.IsDisabled.dirty || submitAttempt)" ion-text color="danger">(*)</span>
                                            </label>
                                        </div>
                                    </ion-col>
                                </ion-row>
                            </form>
                            <ion-row class="hr-group">
                                <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                                    <ion-list-header class="ion-no-padding">
                                        <ion-label color="primary">Thông tin vận chuyển</ion-label>
                                    </ion-list-header>
                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">

                                    <div class="c-control">
                                        <label class="c-label">Mã vận đơn <small>Bill of lading (B/L)</small></label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.Code" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Tuyến đường </label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.Route" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <div class="c-control">
                                        <label class="c-label">Nhân viên giao hàng </label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.Route" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Số xe </label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.VehicleNumber" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">
                                    <div class="c-control">
                                        <label class="c-label">Ngày dự kiến giao hàng </label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.Route" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Ngày giao hàng <small>Shipped date</small> </label>
                                        <input readonly class="c-input" [(ngModel)]="billOfLanding.ShippedDate" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Địa chỉ<small>ShippingAddress</small></label>
                                        <textarea readonly class="c-input" [(ngModel)]="billOfLanding.ShippingAddress" [ngModelOptions]="{standalone: true}" type="textarea"></textarea>
                                    </div>
                                    <!-- <div class="c-control">
                                        <label class="c-label">Ghi chú<small>ShippingAddressRemark</small></label>
                                        <textarea readonly class="c-input" [(ngModel)]="billOfLanding.ShippingAddressRemark" [ngModelOptions]="{standalone: true}" type="textarea"></textarea>
                                    </div> -->



                                </ion-col>
                            </ion-row>
                            <ion-row class="hr-group">
                                <ion-col size="12" size-sm="12" size-md="12" size-xl="3">
                                    <ion-list-header class="ion-no-padding">
                                        <ion-label color="primary">Chứng từ / công nợ</ion-label>
                                    </ion-list-header>
                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">

                                    <div class="c-control">
                                        <label class="c-label">Tổng cộng <small>TotalAfterTax</small></label>
                                        <input readonly class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" suffix=" ₫" [(ngModel)]="item.OriginalTotalAfterTax" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <div class="c-control">
                                        <label class="c-label">Đã nhận <small>Received</small></label>
                                        <input readonly class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" suffix=" ₫" [(ngModel)]="item.Received" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <div class="c-control">
                                        <label class="c-label">Còn nợ <small>Debt</small></label>
                                        <input readonly class="c-input" mask="separator.2" thousandSeparator="," [allowNegativeNumbers]="false" suffix=" ₫" [(ngModel)]="item.Debt" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>

                                    <!-- IsDebt bit Unchecked -->
                                    <!-- IsPaymentReceived bit Unchecked -->

                                </ion-col>
                                <ion-col size="12" size-sm size-xl="4">
                                    <div class="c-control">
                                        <label class="c-label">Hóa đơn</label>
                                        <input readonly class="c-input" [(ngModel)]="item.InvoiceNumber" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Ngày hóa đơn </label>
                                        <input readonly class="c-input" [(ngModel)]="item.InvoicDate" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                    <div class="c-control">
                                        <label class="c-label">Thuế <small>TaxRate</small></label>
                                        <input readonly class="c-input" [(ngModel)]="item.TaxRate" [ngModelOptions]="{standalone: true}" type="text">
                                    </div>
                                </ion-col>
                            </ion-row>

                        </ion-grid>
                    </div>

                </div>

                <div *ngIf="segmentView == 's4'">

                </div>

                <div *ngIf="segmentView == 's5'">

                </div>

                <div *ngIf="segmentView == 's6'">

                </div>
            </div>
        </div>
    </div>

    <app-page-message [itemsLength]="item? 1: 0" [showSpinner]="pageConfig.showSpinner"></app-page-message>


</ion-content>