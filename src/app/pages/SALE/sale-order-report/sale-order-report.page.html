<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start" class="ion-hide-sm-down_">
      <ion-button color="dark" class="ion-hide-sm-down">
        Sale Order Report
      </ion-button>
    </ion-buttons>

    <ion-buttons slot="end">
      <ion-button (click)="refresh()" title="Tải lại">
        <ion-icon slot="icon-only" name="reload-outline"></ion-icon>
      </ion-button>

      <ion-button title="Chức năng mở rộng" (click)="pageConfig.isShowFeature = !pageConfig.isShowFeature;">
        <ion-icon slot="icon-only" [name]="pageConfig.isShowFeature? 'close-outline':'list-circle-outline'">
        </ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content appScrollbarTheme class="ion-padding">

  <!-- feature -->
  <ion-fab [hidden]="!pageConfig.isShowFeature" [ngClass]="{withSearch: pageConfig.isShowSearch}" class="feature"
    vertical="top" horizontal="end" slot="fixed">
    <div class="ion-padding">
      <div class="title">
        <div class="c-control">
          <div class="c-label"><b>BÁO CÁO DOANH THU</b></div>
        </div>

        <div class="c-control">
          <label class="c-label">Chi nhánh</label>
          <ng-container *ngFor="let b of pageBranch">
            <ion-button [fill]="b.IsHidden ? 'outline' : 'solid'" size="small" (click)="toogleBranchDataset(b)">
              {{b.Name}}
            </ion-button>
          </ng-container>
        </div>

        <div class="c-control">
          <label class="c-label" for="StaffCode">Nhân sự</label>

          <ng-select class="c-input" [(ngModel)]="StaffInfo" [ngModelOptions]="{standalone: true}" (clear)="StaffInfo = null; preLoadData(null);"
            [items]="staffList$ | async" [typeahead]="staffListInput$" [loading]='staffListLoading'
            [virtualScroll]="true" bindLabel="FullName" bindId="Id" placeholder="Tìm tên, mã hoặc số điện thoại...">
            <ng-template ng-option-tmp let-i="item" let-search="searchTerm">
              <div *ngIf="i">
                <div><span [ngOptionHighlight]="search">{{i.FullName}}</span></div>
                <small>#<b><span class="important" [ngOptionHighlight]="search">{{i.Id}} - {{i.Code}}</span></b> <span
                    *ngIf="i.Phone"> | điện thoại: <b [ngOptionHighlight]="search">{{i.Phone}}</b></span></small>
              </div>
            </ng-template>
          </ng-select>
        </div>

        <div class="c-control">
          <label class="c-label">Trạng thái</label>

          <select class="c-input c-dropdown" [(ngModel)]="query.IDStatus" [ngModelOptions]="{standalone: true}">
            <option *ngFor="let t of saleOrderStatusList" [value]="t.Id">{{t.Name}}</option>
          </select>
        </div>
      </div>

      <div class="c-control">
        <label class="c-label">Thời gian</label>
        <ion-button *ngIf="rpt.rptGlobal.query.frequency == 1" (click)="changeDateFillter('d')"
          [fill]="rpt.rptGlobal.query.type=='d'? 'solid': 'outline'" size="small">Hôm nay</ion-button>
        <ion-button *ngIf="rpt.rptGlobal.query.frequency == 1" (click)="changeDateFillter('dw')"
          [fill]="rpt.rptGlobal.query.type=='dw'? 'solid': 'outline'" size="small">Tuần này</ion-button>
        <ion-button *ngIf="rpt.rptGlobal.query.frequency == 1" (click)="changeDateFillter('cm')"
          [fill]="rpt.rptGlobal.query.type=='cm'? 'solid': 'outline'" size="small">Tháng này</ion-button>
        <ion-button *ngIf="rpt.rptGlobal.query.frequency == 1" (click)="changeDateFillter('pm')"
          [fill]="rpt.rptGlobal.query.type=='pm'? 'solid': 'outline'" size="small">Tháng trước</ion-button>
        <ion-button (click)="changeDateFillter('set')" [fill]="rpt.rptGlobal.query.type=='set'? 'solid': 'outline'"
          size="small">Tùy chọn...</ion-button>

        <div *ngIf="rpt.rptGlobal.query.type=='set'" class="date-pick">
          <input (blur)="changeDateFillter('setdone')" [(ngModel)]="rpt.rptGlobal.query.fromDate" required type="date"
            pattern="\d{1,2}/\d{1,2}/\d{4}" class="datepicker" name="date" value="" />
          <input (blur)="changeDateFillter('setdone')" [(ngModel)]="rpt.rptGlobal.query.toDate" required type="date"
            pattern="\d{1,2}/\d{1,2}/\d{4}" class="datepicker" name="date" value="" />
        </div>
        <div class="query-time">{{rpt.rptGlobal.query.fromDate}} - {{rpt.rptGlobal.query.toDate}}</div>
      </div>
    </div>
  </ion-fab>


  <div class="main-view">
    <div class="row-full shadow full-screen">
      <div class="ion-padding">
        <ion-grid fixed>

          <ion-row class="hr-group">
            <!-- Total Guest -->
            <ion-col size="12" size-sm="12" size-md="4" size-xl="4">
              <ion-card>
                <ion-card-header>
                  <ion-list-header class="ion-no-padding">
                    <ion-label color="primary">Khách hàng</ion-label>
                  </ion-list-header>
                </ion-card-header>
                <ion-card-content>
                  {{ItemsSummary.TotalGuest}}
                </ion-card-content>
              </ion-card>
            </ion-col>

            <!-- Total SO -->
            <ion-col size="12" size-sm="12" size-md="4" size-xl="4">
              <ion-card>
                <ion-card-header>
                  <ion-list-header class="ion-no-padding">
                    <ion-label color="primary">Đơn hàng</ion-label>
                  </ion-list-header>
                </ion-card-header>
                <ion-card-content>
                  {{ItemsSummary.TotalSO}}
                </ion-card-content>
              </ion-card>
            </ion-col>

            <!-- Total Summary -->
            <ion-col size="12" size-sm="12" size-md="4" size-xl="4">
              <ion-card>
                <ion-card-header>
                  <ion-list-header class="ion-no-padding">
                    <ion-label color="primary">Doanh số</ion-label>
                  </ion-list-header>
                </ion-card-header>
                <ion-card-content>
                  {{ItemsSummary.TotalAfterTaxText}}
                </ion-card-content>
              </ion-card>
            </ion-col>
          </ion-row>
  
          <ion-row class="hr-group">
            <!-- SOSummaryChart -->
            <ion-col size="12" size-sm="12" size-md="12" size-xl="8">
              <ion-row class="hr-group">
                <ion-col size="12" size-sm="12" size-md="12" size-xl="12">
                  <ion-list-header class="ion-no-padding">
                    <ion-label color="primary">Sale Order Summary</ion-label>
                  </ion-list-header>
                </ion-col>
                <ion-col size="12" size-sm="12" size-xl="12">
                  <app-xy-chart [ChartName]="SOSummaryChart"></app-xy-chart>
                </ion-col>
              </ion-row>
            </ion-col>
  
            <!-- SOConvertRateChart -->
            <ion-col size="12" size-sm="12" size-md="12" size-xl="4">
              <ion-row class="hr-group">
                <ion-col size="12" size-sm="12" size-md="12" size-xl="12">
                  <ion-list-header class="ion-no-padding">
                    <ion-label color="primary">Sale Order Conversion Rate</ion-label>
                  </ion-list-header>
                </ion-col>
  
                <ion-col size="12" size-sm="12" size-xl="12">
                  <app-donut-chart [ChartName]="SOConvertRateChart"></app-donut-chart>
                </ion-col>
              </ion-row>
            </ion-col>
          </ion-row>
          
          <ion-row class="hr-group">
            <!-- Top 10 Sale Mans -->
            <ion-col size="12" size-sm="12" size-md="12" size-xl="4">
              <ion-row class="hr-group">
                <ion-col size="12" size-sm="12" size-md="12" size-xl="12">
                  <ion-list-header class="ion-no-padding">
                    <ion-label color="primary">Top 10 Sale Man</ion-label>
                  </ion-list-header>
                </ion-col>
  
                <ion-col size="12" size-sm="12" size-xl="12">
                  <app-bar-image-chart [ChartName]="TopSaleMan"></app-bar-image-chart>
                </ion-col>
              </ion-row>
            </ion-col>
  
            <!-- Top 10 Products -->
            <ion-col size="12" size-sm="12" size-md="12" size-xl="4">
              <ion-row class="hr-group">
                <ion-col size="12" size-sm="12" size-md="12" size-xl="12">
                  <ion-list-header class="ion-no-padding">
                    <ion-label color="primary">Top 10 Products</ion-label>
                  </ion-list-header>
                </ion-col>
  
                <ion-col size="12" size-sm="12" size-xl="12">
                  <app-bar-chart [ChartName]="TopProduct"></app-bar-chart>
                </ion-col>
              </ion-row>
            </ion-col>
  
            <!-- Top 10 Sale Orders -->
            <ion-col size="12" size-sm="12" size-md="12" size-xl="4">
              <ion-row class="hr-group">
                <ion-col size="12" size-sm="12" size-md="12" size-xl="12">
                  <ion-list-header class="ion-no-padding">
                    <ion-label color="primary">Top 10 Sale Orders</ion-label>
                  </ion-list-header>
                </ion-col>
  
                <ion-col size="12" size-sm="12" size-xl="12">
                  <app-bar-chart [ChartName]="TopSale"></app-bar-chart>
                </ion-col>
              </ion-row>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </div>
  </div>

  <div class="main-view">
    <div class="row-1">
      <div class="chart-box" style="width: 100%;">
        <div class="title">BÁO CÁO ĐƠN HÀNG: </div>         <!--<b>In Hopitality - Tháng 11.2021</b> -->
        <div class="chart-contain" style="overflow-x: auto; height: 400px; overflow-y: auto;">
          <table class="data-table fix-height">
            <tr class="company-name">
              <td align="left" style="width: 100px">Id</td>
              <td align="right">Name</td>
              <td align="right">Code</td>
              <td align="right">Order Date</td>
              <td align="right">Sale</td>
              <td align="right">Discount</td>
              <td align="right">Total</td>
            </tr>
            <ng-container *ngFor="let i of items">

              <tr (click)="i.isShow=!i.isShow">
                <td [ngClass]="{bold: i.data}" (click)="showDetail(i)">

                  {{i.Id}}

                </td>
                <td>

                  {{i.Name ? i.Name : i.CustomerName}}

                </td>
                <td>

                  {{i.Code}}

                </td>
                <td>

                  {{i.OrderDateText}}

                </td>
                <td>

                  {{i.Saleman.FullName}}

                </td>
                <td>

                  {{i.TotalDiscount}}

                </td>
                <td>

                  {{i.TotalAfterTaxText}}

                </td>
              </tr>
            </ng-container>

          </table>
        </div>
      </div>
    </div>
  </div>
</ion-content>